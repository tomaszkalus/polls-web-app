{% extends "layout.html" %}
{% set active_page = "profile" %}

{% block page_title %}
Polls - Your Profile
{% endblock %}

{% block content %}

<h1>Hello, {{ user.username }}</h1>

<div class=" w-50 my-5">
    <h4>Profile information:</h4>
    <table class="table">


        <tr>
            <td>Joined:</td>
            <td>{{ user.join_date.strftime('%d.%m.%Y') }}</td>
        </tr>

        <tr>
            <td>Polls created:</td>
            <td>{{ user.number_of_polls_created}}</td>
        </tr>

        <tr>
            <td>Vote count:</td>
            <td>{{ user.number_of_votes }}</td>
        </tr>

    </table>
</div>


<div class="mb-5">
    <h4>Your polls:</h4>
    <ul class="list-group">
        {% if user.polls|length %}
            <ul class="list-group mb-2">
                {% for poll in user.polls[:3] %}
                <li class="list-group-item">
                    <a href="{{ url_for('polls.poll_vote', poll_id=poll.id) }}">{{poll.name}}</a>
                    <div class="mt-1">
                        <span class="me-2"><i class="fas fa-poll me-1"></i>{{ poll.total_number_of_votes }} votes</span>

                        {% if poll.is_unlisted is sameas true %}
                        <span><i class="fas fa-unlock me-1"></i>Unlisted</span>
                        {% else %}
                        <span><i class="fas fa-eye me-1"></i>Public</span>
                        {% endif %}
                        
                    </div>
                </li>
                {% endfor %}
            </ul>
            <a href="">Show all</a>
        {% else %}
            <p class="fst-italic">You haven't created any poll yet.</p>
        {% endif %}

    
</div>

<div class="mb-5">
    <h4>Polls you've voted in:</h4>
    

        {% if user.voted_polls|length %}
            <ul class="list-group mb-2">
                {% for poll in user.voted_polls[:3] %}
                <li class="list-group-item">
                    <a href="{{ url_for('polls.poll_vote', poll_id=poll.id) }}">{{poll.name}}</a>
                    <div class="mt-1">
                        <span class="me-3"><i class="fas fa-user me-2"></i>{{ poll.author.username }}</span>
                        <span><i class="fas fa-poll me-2"></i>{{ poll.total_number_of_votes }}</span>
                    </div>
                </li>
                {% endfor %}
            </ul>
            <a href="">Show all</a>
        {% else %}
            <p class="fst-italic">You haven't voted in any poll yet.</p>
        {% endif %}

        
    
    
</div>

<button type="submit" class="btn btn-primary px-5">Change password</button>
<a href="{{ url_for('auth.delete_account') }}" class="btn btn-danger px-5">Delete account</a>

{% endblock %}